# Caria

#### 介绍

个人项目，前后端分离的视频平台，JS语言，使用MERN技术栈。

本项目的原始地址：

后端：[caria_backend (gitee.com)](https://gitee.com/friksd/caria_backend)

前端：[caria_frontend (gitee.com)](https://gitee.com/friksd/caria_frontend)

此项目使用Docker-compose对以上项目进行整合，后续更新也将在本仓库进行。

#### 软件架构

##### 前端架构

前端项目的文件夹为`caria_frontend`，主要代码在src目录下，其中：

- components为组件文件夹，其中包含了在项目中会经常复用的组件，如导航栏navbar、菜单menu等；
- img为图片文件夹，其中存储了前端的一些默认素材，如logo
- pages为页面文件夹，存储了主界面、登录注册界面等；
- redux文件夹主要提供持续性存储，用于全局访问用户数据等；
- utils中存放了主题配置文件，可实现浅色与深色模式的变更；
- App.js主要配置了各页面的访问路由；
- package.json中除node.js依赖包的信息外，还有配置代理地址，默认接口请求地址为：`http://localhost:8800/api`，如有需求请自行更改。

##### 后端架构

后端项目的文件夹为`caria_backend`，项目架构参考了MVC框架，其中：

- controllers为控制器文件夹，实现了各接口的逻辑，因项目的结构与功能简单以及Express本身的因故，不再单独分出services层；
- models主要存放数据库实体。由于使用monogoDB，其中存放的都是mongoDB的数据对象。由于mongoose模块自带DAO，故不再分文件夹编写数据访问层；
- routes为接口文件夹，提供了外部对本项目api的访问；
- .env文件为配置文件，请将自己的配置导入（尤其是mongoDB的配置地址，由于本项目使用Atlas云数据库，env文件中存放的是个人密钥，本人会自行删除），还有负责生成jwt令牌的随机字符串如有需要也请自行更改；
- error.js为错误页面，功能还未完全实现，请等待后续的编写；
- index.js负责连接数据库以及暴露自身端口，默认8800，并导入routes文件夹中的接口文件来处理接口请求，同时也提供了用户上传文件的储存（请自行新建一个uploads文件夹存放用户上传的文件）；
- verifyToken.js用于认证用户是否登录，以及是否为管理员，在routes文件夹中的接口文件中使用可以实现授权接口请求。

#### 部署教程

首先，请创建一个mongoDB数据库。接下来，在.env文件中进行配置，以下是本项目.env的模板：

```yaml
MONGO=你的数据库连接地址
MAIL_USER="xxx@xx.com"
MAIL_PASS="你申请的密码"
JWT="随机字符串"
ADMIN_JWT_SECRET="随机字符串"
PORT="8800"
```



##### Docker一键部署（推荐）

1. 安装Docker（请自行搜索教程）；

2. 在仓库的主目录下执行：`docker-compose up --build`，进行docker镜像的创建并进行docker-compose，此过程可能需要一会，并占用较大的磁盘空间；

3. 打开`localhost:3000`，部署完成。

##### 前后端分别部署

1. 安装node.js，通过命令行安装npm或者yarn；

2. 进入后端/前端项目目录，执行cmd命令：`yarn`或`npm install`；

3. 在node.js安装所有依赖包后，执行cmd命令：`yarn start`或`npm start`；

4. 推荐先启动后端，再启动前端，后端项目开启后将在创建的数据库中自动创建所需表，前端项目启动后会自动打开主页面。

#### 使用说明

1. 主界面的上方为导航栏，左上角的logo点击可返回主界面，中间的搜索框为字符串匹配搜索，右侧为登录按钮，若用户已登录则会显示为用户头像+用户名；左侧为菜单栏，可对右侧视频分类进行调整，如热门是将所有视频以播放量高低从左往右、从上往下进行降序排列，主页则是随即视频等；菜单可滚动，其最下面是切换深色/浅色模式的按钮。

2. 用户登录界面只需输入正确的用户名与密码即可登录。若用户无账号，可点击登录页面中的立即注册进行注册。注册需输入用户名、密码、确认密码、邮箱、邮箱验证码，密码校验在前端完成。

3. 视频界面可以进行点赞、踩、评论等功能。本项目实现了自定义视频播放，在浏览器自带播放器的基础上新增了一些功能并美化了ui界面。

4. 后台访问`/admin`即可跳转至管理员后台，登录正确的管理员账号即可进入用户管理与视频管理，可进行基础的增删查改等工作。

#### 后续开发方向

本项目由于开发周期较短，还有以下功能未完善（实现）：

1. 主界面中的视频展示部件有些单调，只有三个一行的视频卡片。后续计划丰富内容，结合bilibili或YouTube的前端设计，添加一些轮播图等美化组件；
2. 用户注册的一些安全措施尚未完善，例如防止验证码滥用、识别机器人等；
3. 视频播放界面有些单调，后续可以加上相关视频推荐、相关用户推荐等等；
4. 后台管理并不完善，管理员授权（authorization）、社区规范系统尚未实现，对于不合规范的视频、评论应实行删除，不遵守社区规范的用户应当被banId、banIp等；
5. 在后端方面可以实现一些基本AI算法的应用，如模糊搜索、视频推送等。例如，搜索C++可以搜索到拥有编程、Python、算法等标签的视频；经常看体育类视频的用户会在主页被推送到体育相关视频而非随机视频。以上第二点已有实现思路（KNN），等待后续具体实现；
6. 虽然是个人开发项目，但在学习过程中我了解到了一些大访问量、大数据量场景下的解决方案，希望后续在学习中能够在本项目中实际应用并解决这一问题。

#### 参与贡献

本项目为个人项目，若有发现bug或对本项目有新的想法欢迎提出或commit~

个人联系方式：2410006@qq.com

#### 更新日志

- 24/07/25 更新了历史记录功能，用户可在登录的情况下浏览视频并产生历史记录；优化了播放量的增加，修复了播放量在一次浏览中增加多次的问题；优化了视频页面，避免视频页面中的标题、发布者等信息更新不及时；优化了代码布局。

- 24/07/26 优化了搜索功能，将ElasticSearch中间件添加至项目中，以进行更好的搜索。

- 24/07/27 将ElasticSearch整合至Docker-compose中，实现了整个项目的一键部署。